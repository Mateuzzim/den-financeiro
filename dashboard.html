<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Den | Sistema de Gest√£o Odontol√≥gica</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶∑</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
            zoom: 90%;
        }

        /* Cabe√ßalho */
        .header {
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            color: white;
            padding: 1.2rem 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container { display: flex; align-items: center; gap: 15px; }
        .logo-symbol { font-size: 2.4rem; background: linear-gradient(135deg, #00e5ff 0%, #2979ff 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 5px rgba(0, 229, 255, 0.5)); animation: pulse-glow 3s infinite alternate; }
        .logo-text h1 { font-size: 2.2rem; font-weight: 800; letter-spacing: 2px; background: linear-gradient(90deg, #ffffff 0%, #e3f2fd 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin: 0; line-height: 1; font-family: 'Segoe UI', sans-serif; }
        .logo-text p { font-size: 0.7rem; color: #81d4fa; letter-spacing: 4px; text-transform: uppercase; margin-top: 4px; font-weight: 600; }
        @keyframes pulse-glow { from { filter: drop-shadow(0 0 2px rgba(0, 229, 255, 0.3)); } to { filter: drop-shadow(0 0 10px rgba(0, 229, 255, 0.7)); } }

        .mobile-menu-btn { display: none; background: transparent; border: none; color: white; font-size: 1.5rem; cursor: pointer; margin-right: 10px; }
        .notification-wrapper { position: relative; margin-right: 15px; cursor: pointer; }
        .notification-icon { color: white; font-size: 1.3rem; opacity: 0.8; transition: opacity 0.2s; }
        .notification-wrapper:hover .notification-icon { opacity: 1; }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff1744;
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
            border: 2px solid #1a73e8;
        }
        @keyframes swing { 0% { transform: rotate(0deg); } 10% { transform: rotate(10deg); } 30% { transform: rotate(-10deg); } 50% { transform: rotate(5deg); } 70% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
        .notification-icon.has-new { animation: swing 2s ease infinite; color: #ffeb3b; }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-role {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #bbdefb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #0d47a1;
            font-size: 1.2rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        /* Conte√∫do Principal */
        .main-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Menu Lateral */
        .sidebar {
            width: 260px;
            background-color: white;
            padding: 2rem 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: #5f6368;
            font-weight: 600;
            padding: 0 1.5rem;
            margin-bottom: 0.8rem;
            letter-spacing: 0.5px;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 2px;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 1rem 1.5rem;
            color: #3c4043;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .nav-links a:hover {
            background-color: #f1f8ff;
            color: #1a73e8;
            border-left-color: #1a73e8;
        }

        .nav-links a.active {
            background-color: #e8f0fe;
            color: #1a73e8;
            border-left-color: #1a73e8;
            font-weight: 600;
        }

        .nav-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* √Årea de Conte√∫do */
        .content-area {
            flex: 1;
            padding: 2.5rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
        }

        .page-title h2 {
            font-size: 1.8rem;
            color: #1a237e;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .page-title p {
            color: #5f6368;
            font-size: 1rem;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .stat-info h3 {
            font-size: 0.9rem;
            color: #5f6368;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a237e;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }

        .icon-blue { background-color: #e3f2fd; color: #1976d2; }
        .icon-green { background-color: #e8f5e9; color: #388e3c; }
        .icon-orange { background-color: #fff3e0; color: #f57c00; }
        .icon-purple { background-color: #f3e5f5; color: #7b1fa2; }

        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 1.8rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            height: 100%;
            min-height: 300px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 1.3rem;
            color: #1a237e;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        /* Novos Estilos Dashboard */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .action-btn {
            flex: 1;
            min-width: 0;
            background: white;
            border: none;
            padding: 1.2rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #5f6368;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            font-size: 1rem;
            flex-direction: column;
            text-align: center;
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(26, 115, 232, 0.15);
            color: #1a73e8;
            background: linear-gradient(to bottom, #ffffff, #f0f7ff);
        }

        .action-btn i {
            font-size: 1.4rem;
            margin-bottom: 5px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .action-btn:hover i {
            transform: scale(1.2);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            min-height: 300px;
        }
        
        .dashboard-bottom-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            min-height: 300px;
        }

        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            height: 100%;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        .upcoming-appointments {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            height: 100%;
            min-height: 300px;
            overflow-y: auto;
        }

        .appointment-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .appointment-time {
            background: #e3f2fd;
            color: #1565c0;
            padding: 5px 10px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: 15px;
        }

        .appointment-info h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .appointment-info p {
            font-size: 0.85rem;
            color: #5f6368;
        }

        .btn-access {
            margin-left: auto;
            background: #f0f4f8;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a73e8;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-access:hover {
            background: #e0e0e0;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.2rem;
        }

        .activity-details p {
            font-weight: 500;
            margin-bottom: 0.2rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #5f6368;
        }

        .charts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid #dfe1e5;
            border-radius: 6px;
            background-color: white;
            color: #5f6368;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem;
            color: #5f6368;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 2rem;
        }

        /* Responsividade */
        @media (max-width: 992px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .dashboard-bottom-grid {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .quick-actions {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            body { zoom: 100%; }
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 1rem;
                display: none;
            }

            .sidebar.active {
                display: block;
                animation: slideDown 0.3s ease-out;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .mobile-menu-btn { display: block; }
            .user-info { display: none; }
            .content-area { padding: 1rem; }

            /* Ajustes Mobile para Dashboard */
            .quick-actions { grid-template-columns: 1fr; }
            .chart-container { padding: 1rem; min-height: 250px; }
            .stats-cards { gap: 1rem; }
        }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #eee; padding-bottom: 1rem; }
        .modal-title { font-size: 1.3rem; color: #1a237e; font-weight: 700; }
        .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #5f6368; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #5f6368; }
        .form-control { width: 100%; padding: 0.7rem; border: 1px solid #dfe1e5; border-radius: 6px; font-size: 0.95rem; }
        .btn-primary { background-color: #1a73e8; color: white; border: none; padding: 0.8rem 2rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; width: 100%; }
        .btn-primary:hover { background-color: #1557b0; }
    </style>
</head>
<body>
    <!-- Cabe√ßalho -->
    <header class="header">
        <div style="display: flex; align-items: center;">
            <button class="mobile-menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
            <div class="logo-container">
                <div class="logo-symbol"><i class="fas fa-tooth"></i></div>
                <div class="logo-text">
                    <h1>DEN</h1>
                    <p>FINANCEIRO</p>
                </div>
            </div>
        </div>
        
        <div class="user-menu">
            <div class="notification-wrapper" onclick="window.location.href='configura√ß√µes.html'" title="Mensagens de Contato">
                <i class="fas fa-bell notification-icon"></i>
                <span class="notification-badge" id="msgBadge">0</span>
            </div>
            <div class="user-info">
                <div class="user-name">Mateus</div>
                <div class="user-role">Administrador</div>
            </div>
            <a href="perfil.html" class="user-avatar" title="Ir para Meu Perfil">M</a>
            <a href="index.html" style="color: white; opacity: 0.8; font-size: 1.2rem; margin-left: 10px;" title="Sair"><i class="fas fa-sign-out-alt"></i></a>
        </div>
    </header>

    <!-- Container Principal -->
    <div class="main-container">
        <!-- Menu Lateral -->
        <nav class="sidebar">
            <div class="nav-section">
                <h3 class="nav-title">Menu Principal</h3>
                <ul class="nav-links">
                    <li><a href="dashboard.html" class="active"><i class="fas fa-home nav-icon"></i> Dashboard</a></li>
                    <li><a href="agendamento.html"><i class="fas fa-calendar-check nav-icon"></i> Agendamento</a></li>
                    <li><a href="paciente.html"><i class="fas fa-user-injured nav-icon"></i> Pacientes</a></li>
                    <li><a href="financeiro.html"><i class="fas fa-chart-line nav-icon"></i> Financeiro</a></li>
                    <li><a href="profissonal.html"><i class="fas fa-user-md nav-icon"></i> Profissional</a></li>
                    <li><a href="relatorios.html"><i class="fas fa-chart-pie nav-icon"></i> Relat√≥rios</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h3 class="nav-title">Ferramentas</h3>
                <ul class="nav-links">
                    <li><a href="faturas.html"><i class="fas fa-file-invoice-dollar nav-icon"></i> Faturas</a></li>
                    <li><a href="configura√ß√µes.html"><i class="fas fa-cogs nav-icon"></i> Configura√ß√µes</a></li>
                    <li><a href="usuarios.html"><i class="fas fa-users-cog nav-icon"></i> Usu√°rios</a></li>
                    <li><a href="ajuda.html"><i class="fas fa-question-circle nav-icon"></i> Ajuda</a></li>
                </ul>
            </div>
        </nav>

        <!-- √Årea de Conte√∫do -->
        <main class="content-area">
            <div class="page-header">
                <div class="page-title">
                    <h2>Dashboard Financeiro</h2>
                </div>
                <div class="current-date">
                    <strong>Data atual:</strong> 04 de Fevereiro de 2026
                </div>
            </div>

            <!-- A√ß√µes R√°pidas -->
            <div class="quick-actions">
                <button class="action-btn" onclick="window.location.href='agendamento.html'"><i class="fas fa-calendar-plus" style="color: #1a73e8;"></i> Agendamento</button>
                <button class="action-btn" onclick="abrirModalPaciente()"><i class="fas fa-user-plus" style="color: #43a047;"></i> Novo Paciente</button>
                <button class="action-btn" onclick="window.location.href='relatorios.html'"><i class="fas fa-print" style="color: #8e24aa;"></i> Relat√≥rio</button>
            </div>

            <!-- Cart√µes de Estat√≠sticas -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Faturamento Mensal</h3>
                        <div class="stat-number">R$ 0,00</div>
                    </div>
                    <div class="stat-icon icon-blue">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Pacientes Ativos</h3>
                        <div class="stat-number">0</div>
                    </div>
                    <div class="stat-icon icon-green">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Consultas Hoje</h3>
                        <div class="stat-number">0</div>
                    </div>
                    <div class="stat-icon icon-orange">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Contas a Receber</h3>
                        <div class="stat-number">R$ 0,00</div>
                    </div>
                    <div class="stat-icon icon-purple">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                </div>
                
                <div class="stat-card" id="card-active-users" onclick="window.location.href='usuarios.html'" style="cursor: pointer;">
                    <div class="stat-info">
                        <h3>Usu√°rios Ativos</h3>
                        <div class="stat-number" id="activeSystemUsers">0</div>
                    </div>
                    <div class="stat-icon" style="background-color: #e0f7fa; color: #006064;">
                        <i class="fas fa-user-tie"></i>
                    </div>
                </div>
            </div>

            <!-- Filtro de Per√≠odo -->
            <div class="charts-header">
                <h3 class="section-title" style="margin-bottom: 0;">An√°lise Financeira</h3>
                <select id="periodFilter" class="filter-select">
                    <option value="6months">√öltimos 6 Meses</option>
                    <option value="30days">√öltimos 30 Dias</option>
                    <option value="year">Este Ano</option>
                </select>
            </div>

            <!-- Gr√°fico e Pr√≥ximas Consultas -->
            <div class="dashboard-grid">
                <div class="chart-container">
                    <h3 class="section-title">Faturamento</h3>
                    <div style="flex: 1; position: relative;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="section-title">Procedimentos</h3>
                    <div style="flex: 1; position: relative;">
                        <canvas id="proceduresChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Grid Inferior: A√ß√µes, Consultas, Atividades -->
            <div class="dashboard-bottom-grid">
                <!-- Pr√≥ximas Consultas -->
                <div class="upcoming-appointments">
                    <h3 class="section-title">Pr√≥ximas Consultas</h3>
                    <div id="appointments-list">
                        <!-- Preenchido via JS -->
                    </div>
                </div>

                <!-- Atividades Recentes -->
                <div class="recent-activity">
                    <h3 class="section-title">Atividades Recentes</h3>
                    <ul class="activity-list">
                        <li style="color: #999; font-style: italic; padding: 1rem 0;">Nenhuma atividade recente.</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Novo Paciente -->
    <div id="modalPaciente" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Novo Paciente</h3>
                <button class="close-modal" onclick="fecharModalPaciente()">&times;</button>
            </div>
            <form id="formPaciente">
                <div class="form-group">
                    <label>Nome Completo *</label>
                    <input type="text" id="pacienteNome" class="form-control" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>CPF</label>
                        <input type="text" id="pacienteCpf" class="form-control" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label>Data de Nascimento</label>
                        <input type="date" id="pacienteNascimento" class="form-control">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Celular</label>
                        <input type="tel" id="pacienteCelular" class="form-control" placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label>E-mail</label>
                        <input type="email" id="pacienteEmail" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>Conv√™nio</label>
                    <input type="text" id="pacienteConvenio" class="form-control" placeholder="Ex: Particular, Unimed...">
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea id="pacienteObservacoes" class="form-control" rows="2"></textarea>
                </div>
                <button type="submit" class="btn-primary">Salvar Cadastro</button>
            </form>
        </div>
    </div>

    <!-- Rodap√© -->
    <footer class="footer">
        <p>Den Sistema de Gest√£o Odontol√≥gica ¬© 2026 | Vers√£o 2.5.1</p>
        <p>Este √© um prot√≥tipo baseado no layout do sistema Den</p>
    </footer>

    <script>
        function toggleMenu() {
            document.querySelector('.sidebar').classList.toggle('active');
        }

        // Adicionando interatividade simples ao menu
        function abrirModalPaciente() {
            document.getElementById('modalPaciente').style.display = 'flex';
            document.getElementById('pacienteNome').focus();
        }

        function fecharModalPaciente() {
            document.getElementById('modalPaciente').style.display = 'none';
        }

        document.getElementById('modalPaciente').addEventListener('click', function(e) {
            if (e.target === this) fecharModalPaciente();
        });

        // M√°scara de CPF e Celular no Modal
        document.getElementById('pacienteCpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('pacienteCelular').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
            value = value.replace(/(\d)(\d{4})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('formPaciente').addEventListener('submit', function(e) {
            e.preventDefault();
            const user = firebase.auth().currentUser;
            if (!user) return;

            const nome = document.getElementById('pacienteNome').value;
            const cpf = document.getElementById('pacienteCpf').value;
            const nascimento = document.getElementById('pacienteNascimento').value;
            const celular = document.getElementById('pacienteCelular').value;
            const email = document.getElementById('pacienteEmail').value;
            const convenio = document.getElementById('pacienteConvenio').value;
            const observacoes = document.getElementById('pacienteObservacoes').value;

            if (!nome) {
                alert("O nome do paciente √© obrigat√≥rio.");
                return;
            }

            const novoPaciente = {
                id: Date.now(),
                ownerId: user.uid,
                nome: nome,
                cpf: cpf,
                nascimento: nascimento,
                celular: celular,
                email: email,
                convenio: convenio,
                observacoes: observacoes,
                dataCadastro: new Date().toISOString()
            };

            db.collection('pacientes').doc(String(novoPaciente.id)).set(novoPaciente)
                .then(() => {
                    alert('Paciente cadastrado com sucesso!');
                    document.getElementById('formPaciente').reset();
                    fecharModalPaciente();
                })
                .catch(error => {
                    alert('Erro ao cadastrar: ' + error.message);
                });
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Verificar Autentica√ß√£o Firebase
            auth.onAuthStateChanged((user) => {
                if (!user) {
                    window.location.href = 'login.html';
                } else {
                    // Carregar Dados do Firestore em Tempo Real
                    db.collection('appointments').where('ownerId', '==', user.uid).onSnapshot(snap => {
                        appointments = [];
                        snap.forEach(doc => appointments.push(doc.data()));
                        updateDashboard();
                    });

                    db.collection('pacientes').where('ownerId', '==', user.uid).onSnapshot(snap => {
                        patients = [];
                        snap.forEach(doc => patients.push(doc.data()));
                        updateDashboard();
                    });

                    // Carregar Usu√°rios Ativos (Sistema)
                    db.collection('users').where('status', '==', 'active').onSnapshot(snap => {
                        const el = document.getElementById('activeSystemUsers');
                        if(el) el.textContent = snap.size;
                    });
                }
            });

            // --- CONTROLE DE ACESSO (PERMISS√ïES) ---
            const userRole = localStorage.getItem('userRole') || 'admin';
            const userName = localStorage.getItem('userName') || 'Mateus';
            const userTitle = localStorage.getItem('userTitle') || 'Administrador';

            // 1. Atualizar Cabe√ßalho com Nome e Cargo
            document.querySelector('.user-name').textContent = userName;
            document.querySelector('.user-role').textContent = userTitle;
            
            // 2. Atualizar Avatar
            const userAvatar = localStorage.getItem('userAvatar');
            const avatarEl = document.querySelector('.user-avatar');
            if (userAvatar) {
                avatarEl.style.backgroundImage = `url('${userAvatar}')`;
                avatarEl.style.backgroundSize = 'cover';
                avatarEl.style.backgroundPosition = 'center';
                avatarEl.textContent = '';
            } else {
                avatarEl.textContent = userName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            }

            // 3. Verificar Mensagens de Contato
            const messages = JSON.parse(localStorage.getItem('contactMessages')) || [];
            const unreadCount = messages.filter(m => !m.read).length;
            if (unreadCount > 0) {
                const badge = document.getElementById('msgBadge');
                const icon = document.querySelector('.notification-icon');
                badge.textContent = unreadCount;
                badge.style.display = 'block';
                icon.classList.add('has-new');
            }

            // 3. Aplicar Restri√ß√µes se for Usu√°rio Comum
            if (userRole === 'user') {
                // Ocultar itens do menu lateral (Financeiro, Relat√≥rios, Configura√ß√µes, etc)
                const savedRestricted = localStorage.getItem('restrictedMenus');
                const restrictedMenus = savedRestricted ? JSON.parse(savedRestricted) : ['Financeiro', 'Relat√≥rios', 'Faturas', 'Configura√ß√µes', 'Profissional', 'Usu√°rios'];
                document.querySelectorAll('.nav-links a').forEach(link => {
                    const text = link.textContent.trim();
                    if (restrictedMenus.includes(text)) {
                        link.parentElement.style.display = 'none';
                    }
                });

                // Ocultar Cards Financeiros (Faturamento e Contas a Receber)
                if (restrictedMenus.includes('Financeiro')) {
                    const statsCards = document.querySelectorAll('.stat-card');
                    if (statsCards.length >= 4) {
                        statsCards[0].style.display = 'none'; // Faturamento
                        statsCards[3].style.display = 'none'; // Contas a Receber
                    }

                    // Ajustar layout dos cards para o usu√°rio (evitar espa√ßos vazios)
                    const statsContainer = document.querySelector('.stats-cards');
                    if (statsContainer) {
                        statsContainer.style.gridTemplateColumns = 'repeat(2, 1fr)';
                    }

                    // Ocultar Gr√°ficos Financeiros
                    const chartsSection = document.querySelector('.dashboard-grid');
                    if (chartsSection) chartsSection.style.display = 'none';
                    
                    const chartsHeader = document.querySelector('.charts-header');
                    if (chartsHeader) chartsHeader.style.display = 'none';
                }

                // Ocultar Bot√µes de A√ß√£o R√°pida Financeiros
                const actionBtns = document.querySelectorAll('.action-btn');
                actionBtns.forEach(btn => {
                    const btnText = btn.textContent.trim();
                    if ((btnText.includes('Fatura') && restrictedMenus.includes('Faturas')) || 
                        (btnText.includes('Relat√≥rio') && restrictedMenus.includes('Relat√≥rios'))) {
                        btn.style.display = 'none';
                    }
                });
                
                // Ocultar card de usu√°rios ativos para n√£o-admins
                const cardUsers = document.getElementById('card-active-users');
                if(cardUsers) cardUsers.style.display = 'none';
            }

            const navLinks = document.querySelectorAll('.nav-links a');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Previne comportamento padr√£o apenas para links "#"
                    if(this.getAttribute('href') === '#') {
                        e.preventDefault();
                    }
                    
                    // Remove a classe 'active' de todos os links
                    navLinks.forEach(item => item.classList.remove('active'));
                    
                    // Adiciona a classe 'active' ao link clicado
                    this.classList.add('active');
                    
                    // Atualiza o t√≠tulo da p√°gina com base no item clicado
                    const pageTitle = document.querySelector('.page-title h2');
                    const clickedText = this.textContent.trim();
                    
                    if(clickedText !== 'Dashboard') {
                        pageTitle.textContent = clickedText;
                    } else {
                        pageTitle.textContent = 'Dashboard Financeiro';
                    }
                });
            });
            
            // Atualiza a data atual
            const currentDateElement = document.querySelector('.current-date strong');
            const now = new Date();
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            const formattedDate = now.toLocaleDateString('pt-BR', options);
            
            // Formata para "04 de Fevereiro de 2026"
            const parts = formattedDate.split(' de ');
            const finalDate = `${parts[0]} de ${parts[1].charAt(0).toUpperCase() + parts[1].slice(1)} de ${parts[2]}`;
            
            currentDateElement.parentElement.innerHTML = `<strong>Data atual:</strong> ${finalDate}`;

            let revenueChartInstance;
            let proceduresChartInstance;

            // Vari√°veis globais para dados
            let appointments = [];
            let patients = [];

            function updateDashboard() {
                // FILTRO DE SEGURAN√áA: Se n√£o for admin, filtrar dados apenas do profissional logado
                let filteredAppointments = userRole === 'admin' ? appointments : appointments.filter(app => app.professional === userName);

                // 1. Atualizar Cards de Estat√≠sticas
                // Pacientes Ativos
                document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = patients.length;

                // Consultas Hoje
                const todayDate = new Date();
                const tDay = todayDate.getDate();
                const tMonth = todayDate.getMonth();
                const tYear = todayDate.getFullYear();

                const todayApps = filteredAppointments.filter(app => 
                    app.day === tDay && app.month === tMonth && app.year === tYear
                );
                document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = todayApps.length;

                // 1. Faturamento Mensal (Agendamentos CONCLU√çDOS no m√™s atual)
                const currentMonthRevenue = filteredAppointments
                    .filter(app => app.month === tMonth && app.year === tYear && app.type === 'completed')
                    .reduce((acc, curr) => acc + (parseFloat(curr.value) || 0), 0);

                document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = 
                    currentMonthRevenue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                // 2. Contas a Receber (Agendamentos futuros ou n√£o conclu√≠dos)
                const nowZero = new Date();
                nowZero.setHours(0,0,0,0);
                const receivables = filteredAppointments
                    .filter(app => new Date(app.year, app.month, app.day) >= nowZero && app.type !== 'completed')
                    .reduce((acc, curr) => acc + (parseFloat(curr.value) || 0), 0);

                document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = 
                    receivables.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                // 2. Preparar Dados para Gr√°ficos
                
                // Dados de Procedimentos (Agrupamento)
                const procedureCounts = {};
                filteredAppointments.forEach(app => {
                    const proc = app.procedure ? app.procedure.trim() : 'N√£o informado';
                    const procFormatted = proc.charAt(0).toUpperCase() + proc.slice(1);
                    procedureCounts[procFormatted] = (procedureCounts[procFormatted] || 0) + 1;
                });

                // Ordenar e pegar os top 5 + Outros
                const sortedProcs = Object.entries(procedureCounts).sort((a, b) => b[1] - a[1]);
                let procLabels = [];
                let procData = [];
                
                if (sortedProcs.length > 0) {
                    procLabels = sortedProcs.slice(0, 5).map(p => p[0]);
                    procData = sortedProcs.slice(0, 5).map(p => p[1]);
                    
                    if (sortedProcs.length > 5) {
                        const othersCount = sortedProcs.slice(5).reduce((acc, curr) => acc + curr[1], 0);
                        procLabels.push('Outros');
                        procData.push(othersCount);
                    }
                } else {
                    procLabels = ['Sem dados'];
                    procData = [0];
                }

                // Dados de Faturamento (√öltimos 6 meses)
                const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                const revLabels = [];
                const revData = [];
                
                for (let i = 5; i >= 0; i--) {
                    const d = new Date(todayDate.getFullYear(), todayDate.getMonth() - i, 1);
                    const m = d.getMonth();
                    const y = d.getFullYear();
                    revLabels.push(monthNames[m]);
                    
                    const monthRev = filteredAppointments
                        .filter(app => app.month === m && app.year === y && app.type === 'completed')
                        .reduce((acc, curr) => acc + (parseFloat(curr.value) || 0), 0);
                    
                    revData.push(monthRev);
                }

                // Inicializar Gr√°fico de Receita
                const ctx = document.getElementById('revenueChart').getContext('2d');
                if (revenueChartInstance) revenueChartInstance.destroy();
                revenueChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: revLabels,
                        datasets: [{
                            label: 'Receita (R$)',
                            data: revData,
                            backgroundColor: '#1a73e8',
                            borderRadius: 4,
                            barThickness: 30
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                            x: { grid: { display: false } }
                        }
                    }
                });

                // Gr√°fico de Pizza - Procedimentos
                const ctxPie = document.getElementById('proceduresChart').getContext('2d');
                if (proceduresChartInstance) proceduresChartInstance.destroy();
                proceduresChartInstance = new Chart(ctxPie, {
                    type: 'pie',
                    data: {
                        labels: procLabels,
                        datasets: [{
                            data: procData,
                            backgroundColor: ['#1a73e8', '#43a047', '#fb8c00', '#e53935', '#8e24aa', '#00acc1'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right' } }
                    }
                });

                // 3. Preencher Pr√≥ximas Consultas (Reais)
                const appointmentsList = document.getElementById('appointments-list');
                appointmentsList.innerHTML = '';

                const upcomingApps = filteredAppointments.filter(app => {
                    const appDate = new Date(app.year, app.month, app.day);
                    const nowZero = new Date();
                    nowZero.setHours(0,0,0,0);
                    return appDate >= nowZero;
                }).sort((a, b) => {
                    const dateA = new Date(a.year, a.month, a.day, ...a.time.split(':'));
                    const dateB = new Date(b.year, b.month, b.day, ...b.time.split(':'));
                    return dateA - dateB;
                }).slice(0, 5);

                upcomingApps.forEach(app => {
                    const appDate = new Date(app.year, app.month, app.day);
                    const isToday = appDate.toDateString() === new Date().toDateString();
                    const dateDisplay = isToday ? 'Hoje' : `${app.day}/${app.month + 1}`;

                    appointmentsList.innerHTML += `
                        <div class="appointment-item">
                            <div class="appointment-time" style="min-width: 80px; text-align: center;">
                                <div style="font-size: 0.8rem; opacity: 0.8;">${dateDisplay}</div>
                                ${app.time}
                            </div>
                            <div class="appointment-info">
                                <h4>${app.patient}</h4>
                                <p>${app.procedure || 'Consulta'} - ${app.type === 'confirmed' ? 'Confirmado' : app.type === 'pending' ? 'Pendente' : 'Agendado'}</p>
                            </div>
                            <button class="btn-access" onclick="window.location.href='agendamento.html'" title="Acessar Agendamento"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    `;
                });

                if (upcomingApps.length === 0) {
                    appointmentsList.innerHTML = '<p style="color: #999; font-style: italic; padding: 1rem 0;">Nenhuma consulta futura agendada.</p>';
                }
            }

            // L√≥gica do Filtro de Per√≠odo
            document.getElementById('periodFilter').addEventListener('change', function() {
                console.log('Filtro alterado para:', this.value);
                // Aqui voc√™ pode adicionar l√≥gica para filtrar os dados antes de chamar updateDashboard()
            });
        });
    </script>
</body>
</html>